import $ from"jquery";var config={inputs:{fields:["sales-traffic","sales-conv-rate","sales-avg-order","care-call-volume","care-cost-per-call","care-contact-resolution"],event:"change",eventField:{},callbacks:{}},outputs:{callbacks:{}},debug:!1};export function init(e){model.config(e),controller.init(),model.updateAll(),model.calculate.sales.run(),model.calculate.care.run(),model.calculate.totals.run(),debug.info("Init succeeded.")};const debug={info:function(e,t){if(!config.debug)return!1;window.console.info(e,t||null)}};export const model={config:function(e){config=$.extend(!0,config,e)},inputs:{},update:function(e,t){this.inputs[e]=parseFloat(t)},updateAll:function(){config.inputs.fields.forEach(function(e){var t=$('[data-roi="'+e+'"]').val().replace(/\D/g,"");model.update(e,t)})},calculate:{sales:{run:function(){debug.info("Inputs",model.inputs),this.formula(model.inputs["sales-traffic"],model.inputs["sales-conv-rate"],model.inputs["sales-avg-order"])},increments:{baseline:{acc_rate:0,ord_incr:0,chan_growth:0,conv_rate_m:1},year1:{acc_rate:.01,ord_incr:.1,chan_growth:0,conv_rate_m:2},year2:{acc_rate:.035,ord_incr:.15,chan_growth:0,conv_rate_m:5},year3:{acc_rate:.05,ord_incr:.2,chan_growth:0,conv_rate_m:10}},formula:function(e,t,r){t/=100;for(const u in this.increments){var a=e*t,s=(e-a)*this.increments[u].acc_rate,n=s*this.increments[u].chan_growth,c=s+n,o=t*this.increments[u].conv_rate_m,l=c*(t*this.increments[u].conv_rate_m),i=r+r*this.increments[u].ord_incr;results.sales.raw[u]={digital_orders:a,convo_started:s,convo_w_channels:n,total_convos:c,self_sales_conversion_rate:o,mess_assisted_sales:l,avg_order_value:i},results.sales.increase[u]=r*l,results.sales.average_order_value[u]=(i-r)*l,controller.update("sales-increase-"+u,results.sales.increase[u]),controller.update("sales-avg-order-"+u,results.sales.average_order_value[u])}return results}},care:{run:function(){debug.info("Inputs",model.inputs),this.formula(model.inputs["care-call-volume"],model.inputs["care-cost-per-call"],model.inputs["care-contact-resolution"])},increments:{baseline:{shift_rate:0,fcr_rate_m:0,bcr_rate:0,eff_ratio:0},year1:{shift_rate:.1,fcr_rate_m:1.05,bcr_rate:.1,eff_ratio:1.4},year2:{shift_rate:.3,fcr_rate_m:1.1,bcr_rate:.3,eff_ratio:1.7},year3:{shift_rate:.5,fcr_rate_m:1.15,bcr_rate:.5,eff_ratio:2}},formula:function(e,t,r){r/=100;for(const _ in this.increments){var a=e*this.increments[_].shift_rate,s=r*this.increments[_].fcr_rate_m,n=a*(1-r)-a*(1-s);results.care.fcr[_]=n*t,controller.update("care-fcr-"+_,results.care.fcr[_]);var c=a-n,o=c*this.increments[_].bcr_rate;results.care.ai_scale[_]=o*t,controller.update("care-ai-scale-"+_,results.care.ai_scale[_]);var l=c-o,i=this.increments[_].eff_ratio>0?t/this.increments[_].eff_ratio:0,u=l*t,f=l*i;results.care.efficiency[_]=u-f,controller.update("care-efficiency-"+_,results.care.efficiency[_]),results.care.raw[_]={conversations_shifted:a,messaging_fcr:s,repeat_conversations:n,remaining_conversations:c,bot_contained_conversations:o,remaining_agent_conversations:l,cost_per_messaging_conversation:i,agent_cost_at_baseline:u,agent_cost_with_bots:f}}return results}},totals:{increments:{baseline:{},year1:{},year2:{},year3:{}},run:function(){for(const e in this.increments)results.totals.savings[e]=results.care.fcr[e]+results.care.ai_scale[e]+results.care.efficiency[e],results.totals.growth[e]=results.sales.increase[e]+results.sales.average_order_value[e],results.totals.total_benefit[e]=results.totals.savings[e]+results.totals.growth[e],controller.update("total-savings-"+e,results.totals.savings[e]),controller.update("total-growth-"+e,results.totals.growth[e]),controller.update("total-total-benefit-"+e,results.totals.total_benefit[e]);return results}}}};export var results={sales:{increase:{},average_order_value:{},raw:{}},care:{fcr:{},ai_scale:{},efficiency:{},raw:{}},totals:{savings:{},growth:{},total_benefit:{},raw:{}}};const controller={init:function(){config.inputs.fields.forEach(function(e){$('[data-roi="'+e+'"]').on(config.inputs.eventField[e]||config.inputs.event,function(t){debug.info("Field changed: ",{field:e,value:$(this).val()}),void 0!==config.inputs.callbacks[e]&&config.inputs.callbacks[e]($(this).val(),results),model.updateAll(),model.calculate.sales.run(),model.calculate.care.run(),model.calculate.totals.run()})}),debug.info("View Instantiated.")},update:function(e,t){$('[data-roi="'+e+'"]').text(currency.format(Math.round(t))),void 0!==config.outputs.callbacks[e]&&config.outputs.callbacks[e](t,results,currency.format(Math.round(t)))}};var currency=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});